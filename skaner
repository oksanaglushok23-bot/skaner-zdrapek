<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Skaner Zdrapek</title>
<link rel="manifest" href="manifest.json">
<style>
  body { font-family: sans-serif; text-align:center; margin:0; padding:0; background:#f2f9f2; }
  header { background:#2e7d32; color:white; padding:15px; font-size:1.5em; }
  #scanner { margin:20px auto; width:90%; max-width:400px; }
  video { width:100%; border-radius:8px; border:2px solid #2e7d32; }
  #output { margin:15px; font-size:1.2em; }
  button { padding:10px 20px; font-size:1em; border:none; background:#2e7d32; color:white; border-radius:5px; margin:10px; }
  #history { max-width:400px; margin:0 auto 20px; text-align:left; }
  #history h3 { margin-bottom:5px; }
  #history ul { list-style:none; padding-left:0; }
  #history li { padding:5px; border-bottom:1px solid #ccc; }
</style>
</head>
<body>
<header>Skaner Zdrapek</header>
<div id="scanner">
  <video id="preview"></video>
</div>
<div id="output">Zeskanuj kod ze zdrapki</div>
<button onclick="startScanner()">Rozpocznij skanowanie</button>
<div id="history">
  <h3>Historia skanów:</h3>
  <ul id="scanList"></ul>
</div>

<script type="module">
import QrScanner from "https://cdn.jsdelivr.net/npm/qr-scanner@1.4.2/qr-scanner.min.js";

let videoElem = document.getElementById('preview');
let outputElem = document.getElementById('output');
let scanList = document.getElementById('scanList');
let qrScanner;

// Wczytaj historię z localStorage
let history = JSON.parse(localStorage.getItem('scanHistory') || '[]');
updateHistoryList();

function updateHistoryList() {
    scanList.innerHTML = '';
    history.slice().reverse().forEach(code => {
        let li = document.createElement('li');
        li.textContent = code;
        scanList.appendChild(li);
    });
}

function addToHistory(code) {
    if (!history.includes(code)) { // unikamy duplikatów
        history.push(code);
        localStorage.setItem('scanHistory', JSON.stringify(history));
        updateHistoryList();
    }
}

function startScanner() {
    if (qrScanner) qrScanner.destroy();
    qrScanner = new QrScanner(videoElem, result => {
        outputElem.textContent = "Odczytany kod: " + result;
        addToHistory(result);
        qrScanner.stop();
    }, {
        highlightScanRegion: true,
        highlightCodeOutline: true,
    });
    qrScanner.start().catch(err => {
        outputElem.textContent = "Nie udało się uruchomić kamery: " + err;
    });
}
</script>
</body>
</html>
